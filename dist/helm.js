// HelmJS v0.3.1 - https://github.com/Letdown2491/helmjs
var h=(t,e,n={})=>t.dispatchEvent(new CustomEvent(`h:${e}`,{detail:n,bubbles:!0,cancelable:!0})),J=(t,e)=>{e==="top"?window.scrollTo({top:0,behavior:"smooth"}):e==="bottom"?window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}):(e==="target"?t:document.querySelector(e))?.scrollIntoView({behavior:"smooth",block:"start"})},l=(t,e,n="")=>t.getAttribute(e)??n,C=(t,e)=>{let n=new DOMParser().parseFromString(t,"text/html").querySelector(e);return n?n.innerHTML:t},I=t=>!!t.closest("[h-ignore]"),W=t=>{let e=t.trim().split(/\s+/),n=new Map;for(let s=1;s<e.length;s++){let[o,c]=e[s].split(":");n.set(o,c??"true")}return{event:e[0],mods:n}},x=(t,e)=>{let n;return s=>{clearTimeout(n),n=setTimeout(()=>t(s),e)}},z=(t,e)=>{let n=0;return s=>{let o=Date.now();o-n>=e&&(n=o,t(s))}},q=t=>{if(!t.includes("h-oob"))return t;let e=document.createElement("template");e.innerHTML=t;for(let n of e.content.querySelectorAll("[h-oob]")){let s=n.getAttribute("h-oob")||"true";n.removeAttribute("h-oob");let o=n.id?document.getElementById(n.id):null;o&&v(o,n.outerHTML,s==="true"?"outer":s),n.remove()}return e.innerHTML},v=(t,e,n)=>{n==="inner"?t.innerHTML=e:n==="outer"?t.outerHTML=e:n==="before"?t.insertAdjacentHTML("beforebegin",e):n==="after"?t.insertAdjacentHTML("afterend",e):n==="prepend"?t.insertAdjacentHTML("afterbegin",e):n==="append"?t.insertAdjacentHTML("beforeend",e):n==="morph"&&K(t,e)},K=(t,e)=>{let n=document.createElement("template");n.innerHTML=e.trim(),j(t,n.content)},j=(t,e)=>{let n=[...t.children],s=[...e.children],o=new Map;for(let i of n)i.id&&o.set(i.id,i);let c=new Set,a=0;for(let i of s){let r;i.id&&o.has(i.id)?r=o.get(i.id):a<n.length&&n[a].tagName===i.tagName&&!n[a].id&&!c.has(n[a])&&(r=n[a]);let u=t.children[a]||null;r?(c.add(r),u!==r&&t.insertBefore(r,u),Q(r,i)):t.insertBefore(i.cloneNode(!0),u),a++}for(let i of n)c.has(i)||i.remove()},Q=(t,e)=>{if(t.tagName!==e.tagName){t.replaceWith(e.cloneNode(!0));return}let n=t instanceof HTMLInputElement,s=t instanceof HTMLTextAreaElement;for(let{name:o}of t.attributes)e.hasAttribute(o)||t.removeAttribute(o);for(let{name:o,value:c}of e.attributes)(n||s)&&o==="value"||t.getAttribute(o)!==c&&t.setAttribute(o,c);if(n&&e instanceof HTMLInputElement){let o=e.getAttribute("value");o&&t.value!==o&&(t.value=o),t.checked!==e.checked&&(t.checked=e.checked);return}if(s&&e instanceof HTMLTextAreaElement){let o=e.textContent;o&&t.value!==o&&(t.value=o);return}if(!e.children.length&&!t.children.length){t.textContent!==e.textContent&&(t.textContent=e.textContent);return}j(t,e)},G=t=>{let e=t.tagName;if(t.hasAttribute("h-get")){let n=t.getAttribute(e==="A"?"href":e==="FORM"?"action":"");return n?{method:"GET",action:n}:null}if(e==="FORM"){let n=t.getAttribute("action");if(!n)return null;for(let s of["post","put","patch","delete"])if(t.hasAttribute(`h-${s}`))return{method:s.toUpperCase(),action:n}}return null},X=t=>{if(t.__h||I(t))return;let e=G(t);if(!e||!h(t,"init",{}))return;let n=t.tagName==="FORM"?"submit":"click",s=l(t,"h-trigger",n).split(",").map(a=>a.trim()).filter(Boolean),o=l(t,"h-sync"),c=async a=>{let i=l(t,"h-confirm");if(i&&!confirm(i))return;if(o==="abort"&&t.__hAbort)t.__hAbort.abort();else if(o==="drop"&&t.__hAbort)return;let r=o?new AbortController:void 0;r&&(t.__hAbort=r);let u=t instanceof HTMLFormElement?t:null,p=u?new FormData(u):null;u&&a instanceof SubmitEvent&&a.submitter?.hasAttribute("name")&&p.append(a.submitter.getAttribute("name"),a.submitter.value);let g=l(t,"h-target"),A=g?document.querySelector(g)??t:t,y=l(t,"h-swap","morph"),m=l(t,"h-headers"),S={"H-Request":"true"};if(g&&(S["H-Target"]=g),m)try{S={...S,...JSON.parse(m)}}catch{}let T=e.method==="GET",f={trigger:a,action:e.action,method:e.method,target:A,swap:y,body:T||e.method==="DELETE"?null:p,headers:S};if(a.preventDefault(),!h(t,"before",{cfg:f}))return;let V=!T,U=t.hasAttribute("h-no-disable"),M=[];(V&&!U||t.hasAttribute("h-disabled"))&&(t.tagName==="FORM"?M.push(...t.querySelectorAll('button, input[type="submit"]')):M.push(t));let O=l(t,"h-disabled");O&&M.push(...document.querySelectorAll(O));for(let d of M)d.tagName==="A"?(d.classList.add("h-disabled"),d.setAttribute("aria-disabled","true")):d.setAttribute("disabled","");let D=l(t,"h-indicator"),_=D?document.querySelector(D):null;_&&_.classList.add("h-loading");let w=f.action;if(u&&p&&f.method==="GET"){let d=new URLSearchParams(p);d.toString()&&(w+=(w.includes("?")?"&":"?")+d)}try{let d=await fetch(w,{method:f.method,headers:f.headers,body:f.body,signal:r?.signal}),b=await d.text(),N=l(t,"h-select");if(N&&(b=C(b,N)),d.status>=400){let E=l(t,"h-error-target"),H=E?document.querySelector(E):null;H&&v(H,b,"inner"),h(t,"error",{cfg:f,response:d,html:b})}else if(h(t,"after",{cfg:f,response:d,html:b})){b=q(b);let E=l(t,"h-scroll"),H=E==="target"?f.target:null,R=()=>v(f.target,b,f.swap);if(document.startViewTransition?await document.startViewTransition(R).finished:R(),h(t,"swapped",{cfg:f}),document.contains(t)||h(document.documentElement,"swapped",{cfg:f}),E)if(E==="target"&&f.swap==="outer"){let L=H?.id?document.getElementById(H.id):null;L&&L.scrollIntoView({behavior:"smooth",block:"start"})}else J(f.target,E);let k=t.hasAttribute("h-push-url"),$=t.hasAttribute("h-replace-url");if(k||$){let L={h:!0,url:w,target:g||null,swap:f.swap,select:N||null};k?history.pushState(L,"",w):history.replaceState(L,"",w)}}}catch(d){if(d.name==="AbortError")return;h(t,"error",{cfg:f,error:d})}finally{r&&(t.__hAbort=null);for(let d of M)d.tagName==="A"?(d.classList.remove("h-disabled"),d.removeAttribute("aria-disabled")):d.removeAttribute("disabled");_&&_.classList.remove("h-loading")}};for(let a of s){let{event:i,mods:r}=W(a),u=c;r.has("debounce")&&(u=x(u,parseInt(r.get("debounce"))||300)),r.has("throttle")&&(u=z(u,parseInt(r.get("throttle"))||300));let p=r.get("from"),g=p?document.querySelector(p):t;if(i==="intersect"){let A=parseFloat(r.get("threshold")??"0"),y=r.get("rootMargin")??"0px",m=new IntersectionObserver(S=>{for(let T of S)T.isIntersecting&&(u(new CustomEvent("intersect",{detail:T})),r.has("once")&&m.disconnect())},{threshold:A,rootMargin:y});m.observe(t)}else g&&g.addEventListener(i,u,{once:r.has("once"),capture:r.has("capture"),passive:r.has("passive")})}t.__h=1,h(t,"inited",{})},Y=t=>{if(t.__hsse||I(t))return;let e=l(t,"h-sse");if(!e)return;let n=new Map;t.querySelectorAll("template[h-sse-on]").forEach(a=>{let i=l(a,"h-sse-on"),r=l(a,"h-target");i&&r&&n.set(i,{target:r,swap:l(a,"h-swap","append")})});let s=l(t,"h-target"),o=l(t,"h-swap","append"),c=new EventSource(e);t.__hsse=c,h(t,"sse-connect",{url:e}),n.forEach((a,i)=>{c.addEventListener(i,r=>{let u=document.querySelector(a.target);u&&(v(u,q(r.data),a.swap),h(t,"sse-message",{event:i,data:r.data}))})}),c.onmessage=a=>{if(s){let i=document.querySelector(s);i&&(v(i,q(a.data),o),h(t,"sse-message",{data:a.data}))}},c.onerror=()=>h(t,"sse-error",{url:e})},Z=t=>{if(t.__hpoll||I(t))return;let e=l(t,"h-poll");if(!e)return;let n=e.trim().split(/\s+/),s=n[0],c=(n[1]||"30s").match(/^(\d+)(ms|s|m)?$/),a=c?c[2]==="ms"?+c[1]:c[2]==="m"?+c[1]*6e4:+c[1]*1e3:3e4,i=l(t,"h-swap","inner"),r=l(t,"h-target"),u=l(t,"h-select"),g=setInterval(async()=>{if(!document.contains(t)){clearInterval(g);return}let A=r?document.querySelector(r)??t:t;try{let y=await fetch(s,{headers:{"H-Request":"true",...r?{"H-Target":r}:{}}});if(y.ok){let m=await y.text();u&&(m=C(m,u)),m=q(m),v(A,m,i),h(t,"poll",{url:s,html:m})}}catch{}},a);t.__hpoll=g,h(t,"poll-start",{url:s,interval:a})},B=t=>{G(t)&&X(t),t.hasAttribute("h-sse")&&Y(t),t.hasAttribute("h-poll")&&Z(t)},F=t=>{!(t instanceof Element)||I(t)||(B(t),t.querySelectorAll("a[h-get][href], form[h-get][action], form[h-post][action], form[h-put][action], form[h-patch][action], form[h-delete][action], [h-sse], [h-poll]").forEach(B))},tt=new MutationObserver(t=>{for(let e of t)e.addedNodes.forEach(F)}),P=()=>{tt.observe(document.documentElement,{childList:!0,subtree:!0}),F(document.body)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",P):P();document.addEventListener("h:process",t=>F(t.target));history.replaceState({h:!0,url:location.href,target:null,swap:"morph",select:null},"");window.addEventListener("popstate",async t=>{let e=t.state;if(!e?.h)return;if(!e.target){location.reload();return}let n=document.querySelector(e.target);if(!n){location.reload();return}try{let s=await(await fetch(e.url,{headers:{"H-Request":"true",...e.target?{"H-Target":e.target}:{}}})).text();e.select&&(s=C(s,e.select)),v(n,s,e.swap)}catch{location.reload()}});
