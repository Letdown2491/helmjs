// HelmJS v0.4.0 - https://github.com/Letdown2491/helmjs
var q=new WeakMap,T=t=>q.get(t)||(q.set(t,{}),q.get(t)),E=t=>document.querySelector(t),S=(t,e)=>t.hasAttribute(e),U=(t,e)=>{for(let n of t)n.tagName==="A"?(n.classList.toggle("h-disabled",e),e?n.setAttribute("aria-disabled","true"):n.removeAttribute("aria-disabled")):e?n.setAttribute("disabled",""):n.removeAttribute("disabled")},h=(t,e,n={})=>t.dispatchEvent(new CustomEvent(`h:${e}`,{detail:n,bubbles:!0,cancelable:!0})),Z=(t,e)=>{e==="top"?window.scrollTo({top:0,behavior:"smooth"}):e==="bottom"?window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}):(e==="target"?t:E(e))?.scrollIntoView({behavior:"smooth",block:"start"})},l=(t,e,n="")=>t.getAttribute(e)??n,R=(t,e)=>{let n=new DOMParser().parseFromString(t,"text/html").querySelector(e);return n?n.innerHTML:t},O=t=>!!t.closest("[h-ignore]"),_=t=>{let e=t.trim().split(/\s+/),n=new Map;for(let o=1;o<e.length;o++){let[r,d]=e[o].split(":");n.set(r,d??"true")}return{event:e[0],mods:n}},tt=(t,e)=>{let n;return o=>{clearTimeout(n),n=setTimeout(()=>t(o),e)}},et=(t,e)=>{let n=0;return o=>{let r=Date.now();r-n>=e&&(n=r,t(o))}},F=t=>{if(!t.includes("h-oob"))return t;let e=document.createElement("template");e.innerHTML=t;for(let n of e.content.querySelectorAll("[h-oob]")){let o=n.getAttribute("h-oob")||"true";n.removeAttribute("h-oob");let r=n.id?document.getElementById(n.id):null;r&&M(r,n.outerHTML,o==="true"?"outer":o),n.remove()}return e.innerHTML},M=(t,e,n)=>{n==="inner"?t.innerHTML=e:n==="outer"?t.outerHTML=e:n==="before"?t.insertAdjacentHTML("beforebegin",e):n==="after"?t.insertAdjacentHTML("afterend",e):n==="prepend"?t.insertAdjacentHTML("afterbegin",e):n==="append"?t.insertAdjacentHTML("beforeend",e):n==="morph"&&nt(t,e)},nt=(t,e)=>{let n=document.createElement("template");n.innerHTML=e.trim(),z(t,n.content)},z=(t,e)=>{let n=[...t.childNodes],o=[...e.childNodes],r=n.filter(i=>i.nodeType===1),d=o.filter(i=>i.nodeType===1),a=i=>i.some(u=>u.nodeType===3&&u.textContent?.trim());if(a(n)||a(o)){t instanceof Element&&(t.innerHTML=e instanceof Element?e.innerHTML:e.children[0]?.outerHTML||"");return}let f=new Map;for(let i of r)i.id&&f.set(i.id,i);let s=new Set,c=0;for(let i of d){let u;i.id&&f.has(i.id)?u=f.get(i.id):c<r.length&&r[c].tagName===i.tagName&&!r[c].id&&!s.has(r[c])&&(u=r[c]);let g=t.children[c]||null;u?(s.add(u),g!==u&&t.insertBefore(u,g),rt(u,i)):t.insertBefore(i.cloneNode(!0),g),c++}for(let i of r)s.has(i)||i.remove()},rt=(t,e)=>{if(t.tagName!==e.tagName){t.replaceWith(e.cloneNode(!0));return}let n=t instanceof HTMLInputElement,o=t instanceof HTMLTextAreaElement;for(let{name:r}of t.attributes)e.hasAttribute(r)||t.removeAttribute(r);for(let{name:r,value:d}of e.attributes)(n||o)&&r==="value"||t.getAttribute(r)!==d&&t.setAttribute(r,d);if(n&&e instanceof HTMLInputElement){let r=e.getAttribute("value");r&&t.value!==r&&(t.value=r),t.checked!==e.checked&&(t.checked=e.checked);return}if(o&&e instanceof HTMLTextAreaElement){let r=e.textContent;r&&t.value!==r&&(t.value=r);return}if(!e.children.length&&!t.children.length){t.textContent!==e.textContent&&(t.textContent=e.textContent);return}z(t,e)},K=t=>{let e=t.tagName;if(S(t,"h-get")){let n=t.getAttribute(e==="A"?"href":e==="FORM"?"action":"");return n?{method:"GET",action:n}:null}if(e==="FORM"){let n=t.getAttribute("action");if(!n)return null;for(let o of["post","put","patch","delete"])if(S(t,`h-${o}`))return{method:o.toUpperCase(),action:n}}return null},ot=t=>{if(T(t).init||O(t))return;let e=K(t);if(!e||!h(t,"init",{}))return;let n=t.tagName==="FORM"?"submit":"click",o=l(t,"h-trigger",n).split(",").map(a=>a.trim()).filter(Boolean),r=l(t,"h-sync"),d=async a=>{let f=l(t,"h-confirm");if(f&&!confirm(f))return;let s=T(t);if(r==="abort"&&s.abort)s.abort.abort();else if(r==="drop"&&s.abort)return;let c=r?new AbortController:void 0;c&&(s.abort=c);let i=t instanceof HTMLFormElement?t:null,u=i?new FormData(i):null;i&&a instanceof SubmitEvent&&a.submitter?.hasAttribute("name")&&u.append(a.submitter.getAttribute("name"),a.submitter.value);let g=l(t,"h-target"),H=g?E(g)??t:t,p=l(t,"h-swap","morph"),I=l(t,"h-headers"),w={"H-Request":"true"};if(g&&(w["H-Target"]=g),I)try{w={...w,...JSON.parse(I)}}catch{}let j=e.method==="GET",m={trigger:a,action:e.action,method:e.method,target:H,swap:p,body:j||e.method==="DELETE"?null:u,headers:w};if(a.preventDefault(),!h(t,"before",{cfg:m}))return;let Q=!j,X=S(t,"h-no-disable"),L=[];(Q&&!X||S(t,"h-disabled"))&&(t.tagName==="FORM"?L.push(...t.querySelectorAll('button, input[type="submit"]')):L.push(t));let G=l(t,"h-disabled");G&&L.push(...document.querySelectorAll(G)),U(L,!0);let P=l(t,"h-indicator"),D=P?E(P):null;D&&D.classList.add("h-loading");let A=m.action;if(i&&u&&m.method==="GET"){let b=new URLSearchParams(u);b.toString()&&(A+=(A.includes("?")?"&":"?")+b)}try{let b=await fetch(A,{method:m.method,headers:m.headers,body:m.body,signal:c?.signal}),v=await b.text(),k=l(t,"h-select");if(k&&(v=R(v,k)),b.status>=400){let y=l(t,"h-error-target"),N=y?E(y):null;N&&M(N,v,"inner"),h(t,"error",{cfg:m,response:b,html:v})}else if(h(t,"after",{cfg:m,response:b,html:v})){v=F(v);let y=l(t,"h-scroll"),N=y==="target"?m.target:null,V=()=>M(m.target,v,m.swap);if(document.startViewTransition?await document.startViewTransition(V).finished:V(),h(t,"swapped",{cfg:m}),document.contains(t)||h(document.documentElement,"swapped",{cfg:m}),y)if(y==="target"&&m.swap==="outer"){let C=N?.id?document.getElementById(N.id):null;C&&C.scrollIntoView({behavior:"smooth",block:"start"})}else Z(m.target,y);let $=l(t,"h-focus");$&&E($)?.focus?.();let x=S(t,"h-push-url"),Y=S(t,"h-replace-url");if(x||Y){let C={h:!0,url:A,target:g||null,swap:m.swap,select:k||null};x?history.pushState(C,"",A):history.replaceState(C,"",A)}}}catch(b){if(b.name==="AbortError")return;h(t,"error",{cfg:m,error:b})}finally{c&&(s.abort=void 0),U(L,!1),D&&D.classList.remove("h-loading")}};for(let a of o){let{event:f,mods:s}=_(a),c=d;s.has("debounce")&&(c=tt(c,parseInt(s.get("debounce"))||300)),s.has("throttle")&&(c=et(c,parseInt(s.get("throttle"))||300));let i=s.get("from"),u=i?E(i):t;if(f==="intersect"){let g=parseFloat(s.get("threshold")??"0"),H=s.get("rootMargin")??"0px",p=new IntersectionObserver(I=>{for(let w of I)w.isIntersecting&&(c(new CustomEvent("intersect",{detail:w})),s.has("once")&&p.disconnect())},{threshold:g,rootMargin:H});p.observe(t)}else u&&u.addEventListener(f,c,{once:s.has("once"),capture:s.has("capture"),passive:s.has("passive")})}T(t).init=!0,h(t,"inited",{})},st=t=>{if(T(t).sse||O(t))return;let e=l(t,"h-sse");if(!e)return;let n=new Map;t.querySelectorAll("template[h-sse-on]").forEach(a=>{let f=l(a,"h-sse-on"),s=l(a,"h-target");f&&s&&n.set(f,{target:s,swap:l(a,"h-swap","append")})});let o=l(t,"h-target"),r=l(t,"h-swap","append"),d=new EventSource(e);T(t).sse=d,h(t,"sse-connect",{url:e}),n.forEach((a,f)=>{d.addEventListener(f,s=>{let c=E(a.target);c&&(M(c,F(s.data),a.swap),h(t,"sse-message",{event:f,data:s.data}))})}),d.onmessage=a=>{if(o){let f=E(o);f&&(M(f,F(a.data),r),h(t,"sse-message",{data:a.data}))}},d.onerror=()=>h(t,"sse-error",{url:e})},it=t=>{if(T(t).poll||O(t))return;let e=l(t,"h-poll");if(!e)return;let n=e.trim().split(/\s+/),o=n[0],d=(n[1]||"30s").match(/^(\d+)(ms|s|m)?$/),a=d?d[2]==="ms"?+d[1]:d[2]==="m"?+d[1]*6e4:+d[1]*1e3:3e4,f=l(t,"h-swap","inner"),s=l(t,"h-target"),c=l(t,"h-select"),u=setInterval(async()=>{if(!document.contains(t)){clearInterval(u);return}let g=s?E(s)??t:t;try{let H=await fetch(o,{headers:{"H-Request":"true",...s?{"H-Target":s}:{}}});if(H.ok){let p=await H.text();c&&(p=R(p,c)),p=F(p),M(g,p,f),h(t,"poll",{url:o,html:p})}}catch{}},a);T(t).poll=u,h(t,"poll-start",{url:o,interval:a})},W=t=>{K(t)&&ot(t),S(t,"h-sse")&&st(t),S(t,"h-poll")&&it(t)},B=t=>{!(t instanceof Element)||O(t)||(W(t),t.querySelectorAll("a[h-get][href], form[h-get][action], form[h-post][action], form[h-put][action], form[h-patch][action], form[h-delete][action], [h-sse], [h-poll]").forEach(W))},at=new MutationObserver(t=>{for(let e of t)e.addedNodes.forEach(B)}),J=()=>{at.observe(document.documentElement,{childList:!0,subtree:!0}),B(document.body)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",J):J();document.addEventListener("h:process",t=>B(t.target));history.replaceState({h:!0,url:location.href,target:null,swap:"morph",select:null},"");window.addEventListener("popstate",async t=>{let e=t.state;if(!e?.h)return;if(!e.target){location.reload();return}let n=E(e.target);if(!n){location.reload();return}try{let o=await(await fetch(e.url,{headers:{"H-Request":"true",...e.target?{"H-Target":e.target}:{}}})).text();e.select&&(o=R(o,e.select)),M(n,o,e.swap)}catch{location.reload()}});
