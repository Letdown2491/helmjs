// HelmJS v0.2.0 - https://github.com/Letdown2491/helmjs
var f=(t,e,n={})=>t.dispatchEvent(new CustomEvent(`h:${e}`,{detail:n,bubbles:!0,cancelable:!0})),$=(t,e)=>{e==="top"?window.scrollTo({top:0,behavior:"smooth"}):e==="bottom"?window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}):(e==="target"?t:document.querySelector(e))?.scrollIntoView({behavior:"smooth",block:"start"})},l=(t,e,n="")=>t.getAttribute(e)??n,N=(t,e)=>{let n=new DOMParser().parseFromString(t,"text/html").querySelector(e);return n?n.innerHTML:t},H=t=>!!t.closest("[h-ignore]"),J=t=>{let e=t.trim().split(/\s+/),n=new Map;for(let r=1;r<e.length;r++){let[s,a]=e[r].split(":");n.set(s,a??"true")}return{event:e[0],mods:n}},W=(t,e)=>{let n;return r=>{clearTimeout(n),n=setTimeout(()=>t(r),e)}},x=(t,e)=>{let n=0;return r=>{let s=Date.now();s-n>=e&&(n=s,t(r))}},T=t=>{if(!t.includes("h-oob"))return t;let e=document.createElement("template");e.innerHTML=t;for(let n of e.content.querySelectorAll("[h-oob]")){let r=n.getAttribute("h-oob")||"true";n.removeAttribute("h-oob");let s=n.id?document.getElementById(n.id):null;s&&p(s,n.outerHTML,r==="true"?"outer":r),n.remove()}return e.innerHTML},p=(t,e,n)=>{n==="inner"?t.innerHTML=e:n==="outer"?t.outerHTML=e:n==="before"?t.insertAdjacentHTML("beforebegin",e):n==="after"?t.insertAdjacentHTML("afterend",e):n==="prepend"?t.insertAdjacentHTML("afterbegin",e):n==="append"?t.insertAdjacentHTML("beforeend",e):n==="morph"&&z(t,e)},z=(t,e)=>{let n=document.createElement("template");n.innerHTML=e.trim(),j(t,n.content)},j=(t,e)=>{let n=[...t.children],r=[...e.children],s=new Map;for(let o of n)o.id&&s.set(o.id,o);let a=new Set,i=0;for(let o of r){let u;o.id&&s.has(o.id)?u=s.get(o.id):i<n.length&&n[i].tagName===o.tagName&&!n[i].id&&!a.has(n[i])&&(u=n[i]);let h=t.children[i]||null;u?(a.add(u),h!==u&&t.insertBefore(u,h),K(u,o)):t.insertBefore(o.cloneNode(!0),h),i++}for(let o of n)a.has(o)||o.remove()},K=(t,e)=>{if(t.tagName!==e.tagName){t.replaceWith(e.cloneNode(!0));return}let n=t instanceof HTMLInputElement,r=t instanceof HTMLTextAreaElement;for(let{name:s}of t.attributes)e.hasAttribute(s)||t.removeAttribute(s);for(let{name:s,value:a}of e.attributes)(n||r)&&s==="value"||t.getAttribute(s)!==a&&t.setAttribute(s,a);if(n&&e instanceof HTMLInputElement){let s=e.getAttribute("value");s&&t.value!==s&&(t.value=s),t.checked!==e.checked&&(t.checked=e.checked);return}if(r&&e instanceof HTMLTextAreaElement){let s=e.textContent;s&&t.value!==s&&(t.value=s);return}if(!e.children.length&&!t.children.length){t.textContent!==e.textContent&&(t.textContent=e.textContent);return}j(t,e)},q=t=>{if(t.hasAttribute("h-get")){if(t.tagName!=="A")return null;let e=t.getAttribute("href");return e?{method:"GET",action:e}:null}if(t.tagName==="FORM"){let e=t.getAttribute("action");if(!e)return null;for(let n of["post","put","patch","delete"])if(t.hasAttribute(`h-${n}`))return{method:n.toUpperCase(),action:e}}return null},k=t=>{if(t.__h||H(t))return;let e=q(t);if(!e||!f(t,"init",{}))return;let{event:n,mods:r}=J(l(t,"h-trigger",t.tagName==="FORM"?"submit":"click")),s=async a=>{let i=l(t,"h-confirm");if(i&&!confirm(i))return;let o=t instanceof HTMLFormElement?t:null,u=o?new FormData(o):null;o&&a instanceof SubmitEvent&&a.submitter?.hasAttribute("name")&&u.append(a.submitter.getAttribute("name"),a.submitter.value);let h=l(t,"h-target"),C=h?document.querySelector(h)??t:t,y=l(t,"h-swap","morph"),A=l(t,"h-headers"),b={"H-Request":"true"};if(A)try{b={...b,...JSON.parse(A)}}catch{}let c={trigger:a,action:e.action,method:e.method,target:C,swap:y,body:e.method[0]==="G"||e.method[0]==="D"?null:u,headers:b};if(a.preventDefault(),!f(t,"before",{cfg:c}))return;let G=c.method!=="GET",V=t.hasAttribute("h-no-disable"),E=[];(G&&!V||t.hasAttribute("h-disabled"))&&(t.tagName==="FORM"?E.push(...t.querySelectorAll('button, input[type="submit"]')):E.push(t));let _=l(t,"h-disabled");_&&E.push(...document.querySelectorAll(_));for(let d of E)d.tagName==="A"?(d.classList.add("h-disabled"),d.setAttribute("aria-disabled","true")):d.setAttribute("disabled","");let D=l(t,"h-indicator"),M=D?document.querySelector(D):null;M&&M.classList.add("h-loading");let v=c.action;if(o&&u&&c.method==="GET"){let d=new URLSearchParams(u);d.toString()&&(v+=(v.includes("?")?"&":"?")+d)}try{let d=await fetch(v,{method:c.method,headers:c.headers,body:c.body}),m=await d.text(),L=l(t,"h-select");if(L&&(m=N(m,L)),d.status>=400){let g=l(t,"h-error-target"),w=g?document.querySelector(g):null;w&&p(w,m,"inner"),f(t,"error",{cfg:c,response:d,html:m})}else if(f(t,"after",{cfg:c,response:d,html:m})){m=T(m);let g=l(t,"h-scroll"),w=g==="target"?c.target:null,F=()=>p(c.target,m,c.swap);if(document.startViewTransition?await document.startViewTransition(F).finished:F(),f(t,"swapped",{cfg:c}),document.contains(t)||f(document.documentElement,"swapped",{cfg:c}),g)if(g==="target"&&c.swap==="outer"){let S=w?.id?document.getElementById(w.id):null;S&&S.scrollIntoView({behavior:"smooth",block:"start"})}else $(c.target,g);let O=t.hasAttribute("h-push-url"),U=t.hasAttribute("h-replace-url");if(O||U){let S={h:!0,url:v,target:h||null,swap:c.swap,select:L||null};O?history.pushState(S,"",v):history.replaceState(S,"",v)}}}catch(d){f(t,"error",{cfg:c,error:d})}finally{for(let d of E)d.tagName==="A"?(d.classList.remove("h-disabled"),d.removeAttribute("aria-disabled")):d.removeAttribute("disabled");M&&M.classList.remove("h-loading")}};if(r.has("debounce")&&(s=W(s,parseInt(r.get("debounce"))||300)),r.has("throttle")&&(s=x(s,parseInt(r.get("throttle"))||300)),n==="intersect"){let a=parseFloat(r.get("threshold")??"0"),i=r.get("rootMargin")??"0px",o=new IntersectionObserver(u=>{for(let h of u)h.isIntersecting&&(s(new CustomEvent("intersect",{detail:h})),r.has("once")&&o.disconnect())},{threshold:a,rootMargin:i});o.observe(t)}else t.addEventListener(n,s,{once:r.has("once"),capture:r.has("capture"),passive:r.has("passive")});t.__h=1,f(t,"inited",{})},R=t=>{if(t.__hsse||H(t))return;let e=l(t,"h-sse");if(!e)return;let n=new Map;t.querySelectorAll("template[h-sse-on]").forEach(i=>{let o=l(i,"h-sse-on"),u=l(i,"h-target");o&&u&&n.set(o,{target:u,swap:l(i,"h-swap","append")})});let r=l(t,"h-target"),s=l(t,"h-swap","append"),a=new EventSource(e);t.__hsse=a,f(t,"sse-connect",{url:e}),n.forEach((i,o)=>{a.addEventListener(o,u=>{let h=document.querySelector(i.target);h&&(p(h,T(u.data),i.swap),f(t,"sse-message",{event:o,data:u.data}))})}),a.onmessage=i=>{if(r){let o=document.querySelector(r);o&&(p(o,T(i.data),s),f(t,"sse-message",{data:i.data}))}},a.onerror=()=>f(t,"sse-error",{url:e})},P=t=>{if(t.__hpoll||H(t))return;let e=l(t,"h-poll");if(!e)return;let n=e.trim().split(/\s+/),r=n[0],a=(n[1]||"30s").match(/^(\d+)(ms|s|m)?$/),i=a?a[2]==="ms"?+a[1]:a[2]==="m"?+a[1]*6e4:+a[1]*1e3:3e4,o=l(t,"h-swap","inner"),u=l(t,"h-target"),h=l(t,"h-select"),y=setInterval(async()=>{if(!document.contains(t)){clearInterval(y);return}let A=u?document.querySelector(u)??t:t;try{let b=await fetch(r,{headers:{"H-Request":"true"}});if(b.ok){let c=await b.text();h&&(c=N(c,h)),c=T(c),p(A,c,o),f(t,"poll",{url:r,html:c})}}catch{}},i);t.__hpoll=y,f(t,"poll-start",{url:r,interval:i})},I=t=>{!(t instanceof Element)||H(t)||(q(t)&&k(t),t.hasAttribute("h-sse")&&R(t),t.hasAttribute("h-poll")&&P(t),t.querySelectorAll("a[h-get][href], form[h-post][action], form[h-put][action], form[h-patch][action], form[h-delete][action], [h-sse], [h-poll]").forEach(e=>{q(e)?k(e):e.hasAttribute("h-sse")?R(e):e.hasAttribute("h-poll")&&P(e)}))},Q=new MutationObserver(t=>{for(let e of t)e.addedNodes.forEach(I)}),B=()=>{Q.observe(document.documentElement,{childList:!0,subtree:!0}),I(document.body)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",B):B();document.addEventListener("h:process",t=>I(t.target));history.replaceState({h:!0,url:location.href,target:null,swap:"morph",select:null},"");window.addEventListener("popstate",async t=>{let e=t.state;if(!e?.h)return;if(!e.target){location.reload();return}let n=document.querySelector(e.target);if(!n){location.reload();return}try{let r=await(await fetch(e.url,{headers:{"H-Request":"true"}})).text();e.select&&(r=N(r,e.select)),p(n,r,e.swap)}catch{location.reload()}});
