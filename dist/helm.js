// HelmJS v0.1.0 - https://github.com/Letdown2491/helmjs
var l=(t,e,n={})=>t.dispatchEvent(new CustomEvent(`h:${e}`,{detail:n,bubbles:!0,cancelable:!0})),f=(t,e,n="")=>t.getAttribute(e)??n,F=(t,e)=>{let n=new DOMParser().parseFromString(t,"text/html").querySelector(e);return n?n.innerHTML:t},M=t=>!!t.closest("[h-ignore]"),G=t=>{let e=t.trim().split(/\s+/),n=new Map;for(let s=1;s<e.length;s++){let[r,o]=e[s].split(":");n.set(r,o??"true")}return{event:e[0],mods:n}},B=(t,e)=>{let n;return s=>{clearTimeout(n),n=setTimeout(()=>t(s),e)}},U=(t,e)=>{let n=0;return s=>{let r=Date.now();r-n>=e&&(n=r,t(s))}},S=(t,e,n)=>{n==="inner"?t.innerHTML=e:n==="outer"?t.outerHTML=e:n==="before"?t.insertAdjacentHTML("beforebegin",e):n==="after"?t.insertAdjacentHTML("afterend",e):n==="prepend"?t.insertAdjacentHTML("afterbegin",e):n==="append"?t.insertAdjacentHTML("beforeend",e):n==="morph"&&V(t,e)},V=(t,e)=>{let n=document.createElement("template");n.innerHTML=e.trim(),I(t,n.content)},I=(t,e)=>{let n=[...t.children],s=[...e.children],r=new Map;for(let a of n)a.id&&r.set(a.id,a);let o=new Set,i=0;for(let a of s){let u;a.id&&r.has(a.id)?u=r.get(a.id):i<n.length&&n[i].tagName===a.tagName&&!n[i].id&&!o.has(n[i])&&(u=n[i]);let h=t.children[i]||null;u?(o.add(u),h!==u&&t.insertBefore(u,h),$(u,a)):t.insertBefore(a.cloneNode(!0),h),i++}for(let a of n)o.has(a)||a.remove()},$=(t,e)=>{if(t.tagName!==e.tagName){t.replaceWith(e.cloneNode(!0));return}let n=t instanceof HTMLInputElement,s=t instanceof HTMLTextAreaElement;for(let{name:r}of t.attributes)e.hasAttribute(r)||t.removeAttribute(r);for(let{name:r,value:o}of e.attributes)(n||s)&&r==="value"||t.getAttribute(r)!==o&&t.setAttribute(r,o);if(n&&e instanceof HTMLInputElement){let r=e.getAttribute("value");r&&t.value!==r&&(t.value=r),t.checked!==e.checked&&(t.checked=e.checked);return}if(s&&e instanceof HTMLTextAreaElement){let r=e.textContent;r&&t.value!==r&&(t.value=r);return}if(!e.children.length&&!t.children.length){t.textContent!==e.textContent&&(t.textContent=e.textContent);return}I(t,e)},O=t=>{if(t.hasAttribute("h-get")){if(t.tagName!=="A")return null;let e=t.getAttribute("href");return e?{method:"GET",action:e}:null}if(t.tagName==="FORM"){let e=t.getAttribute("action");if(!e)return null;for(let n of["post","put","patch","delete"])if(t.hasAttribute(`h-${n}`))return{method:n.toUpperCase(),action:e}}return null},A=t=>{if(t.__h||M(t))return;let e=O(t);if(!e||!l(t,"init",{}))return;let{event:n,mods:s}=G(f(t,"h-trigger",t.tagName==="FORM"?"submit":"click")),r=async o=>{let i=f(t,"h-confirm");if(i&&!confirm(i))return;let a=t instanceof HTMLFormElement?t:null,u=a?new FormData(a):null;a&&o instanceof SubmitEvent&&o.submitter?.hasAttribute("name")&&u.append(o.submitter.getAttribute("name"),o.submitter.value);let h=f(t,"h-target"),R=h?document.querySelector(h)??t:t,_=f(t,"h-swap","morph"),H=f(t,"h-headers"),w={"H-Request":"true"};if(H)try{w={...w,...JSON.parse(H)}}catch{}let d={trigger:o,action:e.action,method:e.method,target:R,swap:_,body:e.method[0]==="G"||e.method[0]==="D"?null:u,headers:w};if(o.preventDefault(),!l(t,"before",{cfg:d}))return;let k=d.method!=="GET",P=t.hasAttribute("h-no-disable"),p=[];(k&&!P||t.hasAttribute("h-disabled"))&&(t.tagName==="FORM"?p.push(...t.querySelectorAll('button, input[type="submit"]')):p.push(t));let L=f(t,"h-disabled");L&&p.push(...document.querySelectorAll(L));for(let c of p)c.tagName==="A"?(c.classList.add("h-disabled"),c.setAttribute("aria-disabled","true")):c.setAttribute("disabled","");let N=f(t,"h-indicator"),v=N?document.querySelector(N):null;v&&v.classList.add("h-loading");let m=d.action;if(a&&u&&d.method==="GET"){let c=new URLSearchParams(u);c.toString()&&(m+=(m.includes("?")?"&":"?")+c)}try{let c=await fetch(m,{method:d.method,headers:d.headers,body:d.body}),g=await c.text(),y=f(t,"h-select");if(y&&(g=F(g,y)),c.status>=400){let b=f(t,"h-error-target"),E=b?document.querySelector(b):null;E&&S(E,g,"inner"),l(t,"error",{cfg:d,response:c,html:g})}else if(l(t,"after",{cfg:d,response:c,html:g})){let b=()=>S(d.target,g,d.swap);document.startViewTransition?await document.startViewTransition(b).finished:b(),l(t,"swapped",{cfg:d}),document.contains(t)||l(document.documentElement,"swapped",{cfg:d});let E=t.hasAttribute("h-push-url"),j=t.hasAttribute("h-replace-url");if(E||j){let q={h:!0,url:m,target:h||null,swap:d.swap,select:y||null};E?history.pushState(q,"",m):history.replaceState(q,"",m)}}}catch(c){l(t,"error",{cfg:d,error:c})}finally{for(let c of p)c.tagName==="A"?(c.classList.remove("h-disabled"),c.removeAttribute("aria-disabled")):c.removeAttribute("disabled");v&&v.classList.remove("h-loading")}};s.has("debounce")&&(r=B(r,parseInt(s.get("debounce"))||300)),s.has("throttle")&&(r=U(r,parseInt(s.get("throttle"))||300)),t.addEventListener(n,r,{once:s.has("once"),capture:s.has("capture"),passive:s.has("passive")}),t.__h=1,l(t,"inited",{})},C=t=>{if(t.__hsse||M(t))return;let e=f(t,"h-sse");if(!e)return;let n=new Map;t.querySelectorAll("template[h-sse-on]").forEach(i=>{let a=f(i,"h-sse-on"),u=f(i,"h-target");a&&u&&n.set(a,{target:u,swap:f(i,"h-swap","append")})});let s=f(t,"h-target"),r=f(t,"h-swap","append"),o=new EventSource(e);t.__hsse=o,l(t,"sse-connect",{url:e}),n.forEach((i,a)=>{o.addEventListener(a,u=>{let h=document.querySelector(i.target);h&&(S(h,u.data,i.swap),l(t,"sse-message",{event:a,data:u.data}))})}),o.onmessage=i=>{if(s){let a=document.querySelector(s);a&&(S(a,i.data,r),l(t,"sse-message",{data:i.data}))}},o.onerror=()=>l(t,"sse-error",{url:e})},T=t=>{!(t instanceof Element)||M(t)||(O(t)&&A(t),t.hasAttribute("h-sse")&&C(t),t.querySelectorAll("a[h-get][href]").forEach(A),t.querySelectorAll("form[h-post][action], form[h-put][action], form[h-patch][action], form[h-delete][action]").forEach(A),t.querySelectorAll("[h-sse]").forEach(C))},J=new MutationObserver(t=>{for(let e of t)e.addedNodes.forEach(T)}),D=()=>{J.observe(document.documentElement,{childList:!0,subtree:!0}),T(document.body)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",D):D();document.addEventListener("h:process",t=>T(t.target));history.replaceState({h:!0,url:location.href,target:null,swap:"morph",select:null},"");window.addEventListener("popstate",async t=>{let e=t.state;if(!e?.h)return;if(!e.target){location.reload();return}let n=document.querySelector(e.target);if(!n){location.reload();return}try{let s=await(await fetch(e.url,{headers:{"H-Request":"true"}})).text();e.select&&(s=F(s,e.select)),S(n,s,e.swap)}catch{location.reload()}});
